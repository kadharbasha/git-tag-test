#!/usr/bin/env groovy

def list
pipeline {
    options {
        buildDiscarder(logRotator(numToKeepStr: '6'))
    }
    agent none
    stages {
    	stage('Updated Service'){
    		agent any
    		steps{
	            script {
	            	list = ["dir1", "dir2", "dir3"]
	                for(int i=0; i < list.size(); i++) {
	                    matches = sh script: "git diff --name-only HEAD~1..HEAD | sort -u | awk -F/ {'print \$2'} | uniq | grep -x ${list[i]} || git diff-tree --no-commit-id --name-only -r HEAD | sort -u | awk -F/ {'print \$2'} | uniq | grep -x ${list[i]}"
	                    sh "${matches}"
	                }
	            }
	        }
        }
    }
}
